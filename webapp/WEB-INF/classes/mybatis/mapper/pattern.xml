<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pattern">
	
	<select id="patternDataList" resultType="pattern">
		SELECT *
		FROM tb_pattern_proc
		WHERE 1=1
		AND proc_ptrn_start IS NOT NULL
		AND proc_ptrn_end IS NULL
	</select>
	
	<insert id="patternStartDataSave" parameterType="pattern">
		INSERT INTO tb_pattern_proc 
			(proc_date, proc_ptrn_no, proc_ptrn_start)
		VALUES
			(CURDATE(),#{proc_ptrn_no},NOW())
	</insert>
	
	<update id="patternStartDataForceUpdate" parameterType="pattern">
		UPDATE tb_pattern_proc SET proc_comment = #{proc_comment}, proc_ptrn_end = NOW()
		WHERE proc_ptrn_start = #{proc_ptrn_start}
	</update>
    
    <select id="patternEndDataList" parameterType="pattern" resultType="pattern">
    	SELECT *
    	FROM tb_pattern_proc
    	WHERE 1=1
    	AND proc_ptrn_no = #{proc_ptrn_no}
    	AND proc_ptrn_start IS NOT NULL
    	AND proc_ptrn_end IS NULL
    </select>
    
    <update id="patternEndDataUpdate" parameterType="pattern">
    	UPDATE tb_pattern_proc SET proc_ptrn_end = NOW()
    	WHERE 1=1
    	AND proc_ptrn_no = #{proc_ptrn_no}
    	AND proc_ptrn_start = #{proc_ptrn_start}
    	AND proc_ptrn_end IS NULL
    </update>
    
    
    
    
    <!-- 패턴 이름 조회 (단건) -->
    <select id="getPatternName" parameterType="int" resultType="pattern">
        SELECT 
            pattern_no,
            pattern_name,
            tdatetime
        FROM tb_pattern_name
        WHERE pattern_no = #{pattern_no}
    </select>
    
    <!-- 전체 패턴 이름 조회 -->
    <select id="getAllPatternNames" resultType="pattern">
        SELECT 
            pattern_no,
            pattern_name,
            tdatetime
        FROM tb_pattern_name
        ORDER BY pattern_no ASC
    </select>
    
    <!-- 패턴 이름 수정 -->
    <update id="updatePatternName" parameterType="pattern">
        UPDATE tb_pattern_name
        SET 
            pattern_name = #{pattern_name},
            tdatetime = NOW()
        WHERE pattern_no = #{pattern_no}
    </update>
    
    <!-- 패턴 이름 초기화 -->
    <update id="resetPatternName" parameterType="int">
        UPDATE tb_pattern_name
        SET 
            pattern_name = CONCAT('패턴 ', pattern_no),
            tdatetime = NOW()
        WHERE pattern_no = #{pattern_no}
    </update>
    
    <!-- 패턴 이름 존재 여부 확인 -->
    <select id="checkPatternNameExists" parameterType="int" resultType="int">
        SELECT COUNT(*)
        FROM tb_pattern_name
        WHERE pattern_no = #{pattern_no}
    </select>
    
    <!-- 패턴 이름 초기 데이터 삽입 -->
    <insert id="insertPatternName" parameterType="pattern">
        INSERT INTO tb_pattern_name (pattern_no, pattern_name, tdatetime)
        VALUES (#{pattern_no}, #{pattern_name}, NOW())
    </insert>
    
    
    
    
    
    
    
    
    
    
    
    
    
</mapper>